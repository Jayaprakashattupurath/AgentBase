# Health Monitoring Agent (AgentBase)

AgentBase is a production-ready scaffold for building an agentic Health Monitoring and Alerting system tailored to aged, weak, and special-care users (including people living with Alzheimer's). It provides a clean, extendable Python structure with FastAPI endpoints, core agent logic, tool abstractions, basic memory, and CI-ready ops files.

## What this project does
- Monitors vitals such as heart rate, SpO2, and body temperature
- Detects important events (e.g., falls) and generates actionable alerts
- Exposes a simple API to ingest measurements and retrieve agent assessments
- Provides a foundation for expanding into LLM-driven reasoning, richer memory, and caregiver workflows

## Highlights
- Clear package layout under `src/agent_project/` following application/core/infrastructure separation
- Minimal, readable agent loop with transparent rule-based thresholds you can tune
- FastAPI app ready to run locally or in Docker
- Lightweight long-term memory stub for experimentation
- Ready-to-use Makefile, tests, linting, and GitHub Actions CI

## Directory overview
```
agent-project/
  .github/workflows/ci.yml        # Lint and test on PRs
  data/                           # Datasets / artifacts (placeholder)
  notebooks/                      # Prompt/memory/tool exploration notebooks
  src/agent_project/
    application/                  # Use-case services
    core/                         # Agent, tools, prompts, utils
    infrastructure/               # API, monitoring, vector DB, LLM client stubs
  tools/                          # CLI entrypoints
  tests/                          # Unit tests
  Dockerfile, Makefile, pyproject.toml, config.py
```

## Core components
- `HealthAgent` (`src/agent_project/core/agent/agent.py`):
  - Accepts a vitals event and returns an assessment
  - Triggers alerts via `AlertDispatcher` when thresholds are exceeded or a fall is detected
  - Integrates with rule engine to tag events with custom features and labels
- `Rule Engine` (`src/agent_project/application/rule_engine/`):
  - Flexible rule system for tagging events with custom features, labels, and metadata
  - Supports complex conditions (comparisons, logical operators, nested field access)
  - Rules can be created, managed, and disabled via API
  - Enables future extensibility for patient-specific care protocols
- `Vitals rules` (`src/agent_project/core/tools/vitals.py`):
  - Simple, transparent thresholds for `heart_rate`, `spo2`, `temperature_c`
  - Built to be swapped for advanced analytics or ML
- `Alert dispatcher` (`src/agent_project/core/tools/alerts.py`):
  - Sends alerts to stdout and optional webhook (stubbed for easy extension to SMS/Email)
- `API` (`src/agent_project/infrastructure/api/app.py`):
  - `GET /health` healthcheck
  - `POST /v1/analyze` to analyze a vitals payload
  - `POST /v1/rules` to create rules
  - `GET /v1/rules` to list all rules
  - `GET /v1/rules/{rule_id}` to get a specific rule
  - `DELETE /v1/rules/{rule_id}` to delete a rule

## Example API payload
```json
{
  "heart_rate": 130,
  "spo2": 89,
  "temperature_c": 39.1,
  "fall_detected": false,
  "meta": {
    "patient_type": "alzheimer",
    "age": 82
  }
}
```

The response includes tags generated by the rule engine:
```json
{
  "assessment": {...},
  "alerts": [...],
  "tags": {
    "features": ["alzheimer_patient", "cognitive_care"],
    "labels": ["special_care", "high_priority"],
    "metadata": {"care_level": "intensive"},
    "matched_rules": ["alzheimer_patient_tag"]
  }
}
```

## Rule Engine Example

Create a rule to tag Alzheimer's patients:
```bash
curl -X POST http://localhost:8000/v1/rules \
  -H "Content-Type: application/json" \
  -d '{
    "id": "alzheimer_tag",
    "name": "Alzheimer Patient Tag",
    "condition": {
      "conditions": [{
        "field": "meta.patient_type",
        "operator": "eq",
        "value": "alzheimer"
      }],
      "operator": "AND"
    },
    "action": {
      "features": ["alzheimer_patient"],
      "labels": ["special_care"],
      "metadata": {"monitoring": "intensive"}
    }
  }'
```

See `tools/manage_rules.py` for a complete example with multiple rules.

## Extending the system
- Replace the vector memory stub with a real store (e.g., FAISS/pgvector)
- Add provider-specific alert channels (Twilio SMS, SendGrid Email, PagerDuty, Slack)
- Introduce rolling-window analytics, anomaly detection, or personalization per user
- Integrate LLM reasoning via `infrastructure/llm_clients` and `core/prompts`

## Getting started
See `bootstrap.md` for step-by-step setup, environment variables, running locally or via Docker, and testing.
